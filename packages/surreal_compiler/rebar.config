{erl_opts, [debug_info]}.

{deps, []}.

%% Hex.pm metadata
{hex, [
    {doc, #{provider => ex_doc}}
]}.

{project_plugins, [rebar3_hex, rebar3_ex_doc]}.

{ex_doc, [
    {extras, ["README.md", "LICENSE"]},
    {main, "README.md"},
    {source_url, "https://github.com/surreal-lang/surreal"}
]}.

{profiles, [
    {test, [
        {erl_opts, [debug_info]}
    ]},
    %% Development profile - builds NIF locally
    {dev, [
        {pre_hooks, [
            {"(linux|darwin|solaris)", compile, "cargo build --release --manifest-path=native/surreal_native/Cargo.toml"},
            {"win32", compile, "cargo build --release --manifest-path=native/surreal_native/Cargo.toml"}
        ]},
        {post_hooks, [
            {"(darwin)", compile, "cp native/surreal_native/target/release/libsurreal_native.dylib priv/libsurreal_native.dylib"},
            {"(linux)", compile, "cp native/surreal_native/target/release/libsurreal_native.so priv/libsurreal_native.so"},
            {"win32", compile, "copy native\\surreal_native\\target\\release\\surreal_native.dll priv\\libsurreal_native.dll"}
        ]}
    ]}
]}.

%% Escript configuration for running the REPL
{escript_incl_apps, [surreal_compiler]}.
{escript_main_app, surreal_compiler}.
{escript_name, surreal}.
{escript_emu_args, "%%! -noshell -noinput\n"}.

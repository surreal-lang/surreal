{erl_opts, [debug_info]}.

{deps, []}.

%% Pre-compile hook to build the Rust NIF
{pre_hooks, [
    {"(linux|darwin|solaris)", compile, "cargo build --release --manifest-path=native/surreal_native/Cargo.toml"},
    {"win32", compile, "cargo build --release --manifest-path=native/surreal_native/Cargo.toml"}
]}.

%% Post-compile hook to copy the NIF to priv/
{post_hooks, [
    {"(darwin)", compile, "cp native/surreal_native/target/release/libsurreal_native.dylib priv/libsurreal_native.so"},
    {"(linux)", compile, "cp native/surreal_native/target/release/libsurreal_native.so priv/libsurreal_native.so"},
    {"win32", compile, "copy native\\surreal_native\\target\\release\\surreal_native.dll priv\\libsurreal_native.dll"}
]}.

{project_plugins, []}.

{profiles, [
    {test, [
        {erl_opts, [debug_info]}
    ]}
]}.

%% Escript configuration for running the REPL
{escript_incl_apps, [surreal_compiler]}.
{escript_main_app, surreal_compiler}.
{escript_name, surreal}.
{escript_emu_args, "%%! -noshell -noinput\n"}.

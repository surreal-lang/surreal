// Tests for http_api
// Only compiled when running `dream test`

use crate::models::user::User;

#[test]
pub fn test_user_to_json() -> atom {
    // Create a user and convert to JSON map using the derive macro generated method
    let user = User::new(42, "Alice");
    let json = user.to_json();

    // Check that the map has the correct keys and values
    let id = :maps::get(:id, json);
    let name = :maps::get(:name, json);

    if id != 42 {
        :erlang::error((:wrong_id, id))
    } else {
        if name != "Alice" {
            :erlang::error((:wrong_name, name))
        } else {
            :ok
        }
    }
}

#[test]
pub fn test_addition() -> atom {
    let result = 1 + 1;
    if result != 2 {
        :erlang::error(:assertion_failed)
    } else {
        :ok
    }
}

#[test]
pub fn test_list_operations() -> atom {
    let list = [1, 2, 3];
    let len = :erlang::length(list);
    if len != 3 {
        :erlang::error(:wrong_length)
    } else {
        :ok
    }
}

#[test]
pub fn test_map_operations() -> atom {
    let map = :maps::new();
    let map = :maps::put(:key, "value", map);
    match :maps::get(:key, map) {
        "value" => :ok,
        _ => :erlang::error(:wrong_value)
    }
}
